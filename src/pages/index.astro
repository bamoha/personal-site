---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import ArrowCard from "@components/ArrowCard.astro";
import { SITE, HOME, SOCIALS } from "@consts";
import { formatDate } from "@lib/utils";

const allBlogPosts = await getCollection("blog");
const blogPosts = allBlogPosts
  .filter((post: any) => !post.data.draft)
  .sort((a: any, b: any) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const speakingEntries = (await getCollection("speaking"))
  .sort((a: any, b: any) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_SPEAKING_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project: any) => !project.data.draft)
  .sort((a: any, b: any) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <div class="space-y-10">
      <section class="animate space-y-4">
        <div class="flex flex-col items-center gap-4">
          <div class="relative w-40 h-40 rounded-full overflow-hidden ring-4 ring-black/10 dark:ring-white/10 animate-profile">
            <img 
              src="/bashir.png" 
              alt="Bashir Hamza"
              class="w-full h-full object-cover object-[center_35%]"
            />
          </div>
          <h1 class="font-semibold text-2xl text-black dark:text-[#d1d5db]">
            Hi, I'm Bashir üëãüèª
          </h1>
        </div>
        <div class="text-black/75 dark:text-[#d1d5db]">
          <p>
            I am Bashir, a Software Craftsman with close to a decade of
            experience shaping digital products. I treat software as a craft,
            not just a job. Every line of code I write carries intention. I
            build things that are clear, resilient, and designed to last. Over
            the years, I have worked across startups and established teams,
            helping businesses solve real problems through thoughtful engineering
            and user-centered design.
          </p>
          <div 
            id="bio-expanded" 
            class="space-y-4 mt-4 grid transition-all duration-500 ease-in-out"
            style="grid-template-rows: 0fr; opacity: 0;"
          >
            <div class="overflow-hidden">
              <p>
                I believe good software comes from good judgment. Knowing when to
                build and when to hold back. Choosing simplicity over cleverness.
                Understanding that the best solutions often involve writing less
                code, not more. I take pride in building systems that are easy to
                change, easy to understand, and honest about what they do. I care
                about performance, accessibility, and the small details that
                separate good work from great work.
              </p>
              <p class="mt-4">
                Craft is also about growth. I invest in sharpening my instincts,
                learning from failure, and staying curious about how things work
                beneath the surface. I read widely, experiment constantly, and
                try to understand not just how to build things, but why certain
                approaches stand the test of time. I speak at community events
                like DevFest Abuja and Abeokuta, contribute to developer
                communities like Consonance Club and JsIfe, and mentor through
                initiatives like Codeday. Passing knowledge forward is part of
                the craft.
              </p>
              <p class="mt-4">
                When I am not writing code, I enjoy reading about world history,
                automobiles, and aircrafts. I find patterns in how things are
                built, whether it is software, engines, or civilizations. I also
                love pandas, the animal, not the Python library. Mostly because
                they are black, white, Asian, and somehow manage to represent
                many cultures at once.
              </p>
            </div>
          </div>
          <div class="flex justify-center">
            <button 
              id="bio-toggle"
              class="mt-3 text-sm text-black/50 hover:text-black dark:text-white/50 dark:hover:text-white transition-colors flex items-center gap-1"
            >
              <span id="bio-toggle-text">Read more</span>
              <svg 
                id="bio-toggle-icon"
                xmlns="http://www.w3.org/2000/svg" 
                width="14" 
                height="14" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                stroke-width="2" 
                stroke-linecap="round" 
                stroke-linejoin="round"
                class="transition-transform duration-300"
              >
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
          </div>
        </div>
      </section>
      
      <script>
        function initBioToggle() {
          const toggle = document.getElementById("bio-toggle");
          const expanded = document.getElementById("bio-expanded");
          const toggleText = document.getElementById("bio-toggle-text");
          const toggleIcon = document.getElementById("bio-toggle-icon");
          let isExpanded = false;
          
          toggle?.addEventListener("click", () => {
            isExpanded = !isExpanded;
            if (isExpanded) {
              expanded!.style.gridTemplateRows = "1fr";
              expanded!.style.opacity = "1";
              toggleText!.textContent = "Show less";
              toggleIcon?.classList.add("rotate-180");
            } else {
              expanded!.style.gridTemplateRows = "0fr";
              expanded!.style.opacity = "0";
              toggleText!.textContent = "Read more";
              toggleIcon?.classList.remove("rotate-180");
            }
          });
        }
        
        initBioToggle();
        document.addEventListener("astro:after-swap", initBioToggle);
      </script>

      {
        blogPosts.length > 0 && (
          <section class="animate space-y-4">
            <div class="flex items-center justify-between">
              <h2 class="font-semibold text-black dark:text-[#d1d5db]">Blog</h2>
              <a
                href="/blog"
                class="text-sm text-black/50 hover:text-black dark:text-[#d1d5db]/50 dark:hover:text-[#d1d5db] transition-colors"
              >
                View all ‚Üí
              </a>
            </div>
            <ul class="flex flex-col gap-4">
              {blogPosts.map((post) => (
                <li>
                  <ArrowCard entry={post} />
                </li>
              ))}
            </ul>
          </section>
        )
      }

      {
        speakingEntries.length > 0 && (
          <section class="animate space-y-4">
            <div class="flex items-center justify-between">
              <h2 class="font-semibold text-black dark:text-[#d1d5db]">Speaking</h2>
              <a
                href="/speaking"
                class="text-sm text-black/50 hover:text-black dark:text-[#d1d5db]/50 dark:hover:text-[#d1d5db] transition-colors"
              >
                View all ‚Üí
              </a>
            </div>
            <ul class="flex flex-col gap-4">
              {speakingEntries.map((entry: any) => (
                <li>
                  <div class="text-sm opacity-75 mb-1">
                    {formatDate(entry.data.date)}
                    {entry.data.location && ` ‚Ä¢ ${entry.data.location}`}
                  </div>
                  <div class="font-semibold text-black dark:text-[#d1d5db]">
                    {entry.data.title}
                  </div>
                  <div class="text-sm opacity-75">{entry.data.event}</div>
                </li>
              ))}
            </ul>
          </section>
        )
      }

      <section class="animate space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold text-black dark:text-[#d1d5db]">Projects</h2>
          <a
            href="/projects"
            class="text-sm text-black/50 hover:text-black dark:text-[#d1d5db]/50 dark:hover:text-[#d1d5db] transition-colors"
          >
            View all ‚Üí
          </a>
        </div>
        {
          projects.length > 0 ? (
            <ul class="flex flex-col gap-4">
              {projects.map((project) => (
                <li>
                  <ArrowCard entry={project} />
                </li>
              ))}
            </ul>
          ) : (
            <div class="flex flex-col items-center justify-center py-12 px-6 rounded-lg border border-dashed border-black/20 dark:border-white/20 bg-black/5 dark:bg-white/5">
              <div class="text-3xl mb-3">üöß</div>
              <div class="font-semibold text-black dark:text-[#d1d5db] mb-1">Coming Soon</div>
              <p class="text-sm text-black/50 dark:text-white/50 text-center">
                Exciting projects in the works. Stay tuned!
              </p>
            </div>
          )
        }
      </section>

      <section class="animate space-y-4">
        <h2 class="font-semibold text-black dark:text-[#d1d5db]">Contact Me!</h2>
        <p class="text-black/75 dark:text-[#d1d5db]">
          I'm always open and ready to talk, whether for a potential project,
          open source, community work or just to say hi, I'll definitely reply
          you as soon as possible!
        </p>
      </section>

      <section class="animate space-y-4">
        <div class="flex items-center gap-4">
          <a
            href={`mailto:${SITE.EMAIL}`}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center justify-center size-12 rounded-lg border border-black/15 dark:border-white/20 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-all duration-300 ease-in-out hover:scale-105"
            aria-label="Email"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="text-black dark:text-[#d1d5db]"
            >
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
            </svg>
          </a>
          {
            SOCIALS.filter(
              (social) =>
                social.NAME === "twitter-x" ||
                social.NAME === "linkedin" ||
                social.NAME === "github"
            ).map((social) => (
              <a
                href={social.HREF}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center justify-center size-12 rounded-lg border border-black/15 dark:border-white/20 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-all duration-300 ease-in-out hover:scale-105"
                aria-label={
                  social.NAME === "twitter-x"
                    ? "Twitter"
                    : social.NAME === "linkedin"
                      ? "LinkedIn"
                      : "GitHub"
                }
              >
                {social.NAME === "twitter-x" ? (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="text-black dark:text-[#d1d5db]"
                  >
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                  </svg>
                ) : social.NAME === "linkedin" ? (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="text-black dark:text-[#d1d5db]"
                  >
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                  </svg>
                ) : (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="text-black dark:text-[#d1d5db]"
                  >
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                  </svg>
                )}
              </a>
            ))
          }
        </div>
      </section>
    </div>
  </Container>
</PageLayout>
